!function(a,b){"use strict";var c=function(c,d){this.Sizzle=a,this.jsondiffpatch=b,this._currentObj=this.deepClone(c),this._currentObjType=this.typeOfObj(c),this.el=d};c.prototype.typeOfObj=function(a){return"undefined"==typeof a?"undefined":null===a?"null":"string"==typeof a?"string":"number"==typeof a?"number":"boolean"==typeof a?"boolean":a instanceof RegExp?"regex":a instanceof Array?"array":"object"},c.prototype.deepClone=function(a){switch(this._currentObjType){case"object":case"array":return JSON.parse(JSON.stringify(a));default:return a}},c.prototype.update=function(a){"undefined"!=typeof a&&(this._oldObj=this._currentObj,this._currentObj=this.deepClone(a),this._currentObjType=this.typeOfObj(a),this._updateDelta(),this.d.update(this.el,this.delta))},c.prototype._updateDelta=function(){this.delta=this.jsondiffpatch.diff(this._oldObj,this._currentObj)},c.prototype.render=function(a){a=a||{},a.raw=a.raw||!1;var b=this.r.render(this._currentObj,a);this.el.appendChild(b)};var d=function(){this.base={text:document.createTextNode(""),span:document.createElement("span"),div:document.createElement("div"),pre:document.createElement("pre"),a:document.createElement("a")},this.templates={arrow:this.createEl("span","icon-arrow"),number:this.createEl("span","number"),string:this.createEl("span","string"),key:this.createEl("span","key"),empty:this.createEl("span","null"),innerBlock:this.createEl("span","inner-block"),quote:this.createEl("span","quote",'"'),bracketOpen:this.createEl("span","bracket bracket-open","["),bracketClose:this.createEl("span","bracket bracket-close","]"),braceOpen:this.createEl("span","brace brace-open","{"),braceClose:this.createEl("span","brace brace-close","}"),ellipsis:this.createEl("span","ellipsis"),comma:this.createEl("span","comma",","),sep:this.createEl("span","sep",":Â ")},document.addEventListener("click",this.clickHandler,!1)};d.prototype.render=function(a,b){if(b.raw){var c=this.setText(this.createEl("pre"),a);return c.className="json-view",c}return this._renderObj(a)},d.prototype._renderObj=function(a){var b=this._buildObjEl(a);return this.append(this.createEl("span","js-visualizer"),b)},d.prototype._empty=function(a){var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0},d.prototype._group=function(a){var b=c.prototype.typeOfObj(a);return"object"===b||"array"===b},d.prototype._attachValPrefix=function(a,b,c){if(this._group(b)&&!this._empty(b)&&(a=this.append(a,this.template("arrow"))),c!==!1){a.classList.add("object-property");var d=this.template("key");d=this.setText(d,JSON.stringify(c).slice(1,-1)),a=this.wrap(a,d,"quote"),a=this.append(a,this.template("sep"))}else a.classList.add("array-element");return a},d.prototype._attachKeyDom=function(a,b,c){var d,e,f;switch(c){case"string":d=this.createEl("span");var g=this.template("string"),h=JSON.stringify(b);h=h.substring(1,h.length-1),g=this.setText(g,h),d=this.wrap(d,g,"quote"),a=this.append(a,d);break;case"object":if(a=this.append(a,this.template("braceOpen")),!this._empty(b)){a=this.append(a,this.template("ellipsis")),d=this.template("innerBlock");for(f in b)b.hasOwnProperty(f)&&(e=this._buildObjEl(b[f],f),f<b.length-1&&(e=this.append(e,this.template("comma"))),d=this.append(d,e));a=this.append(a,d)}a=this.append(a,this.template("braceClose"));break;case"array":if(a=this.append(a,this.template("bracketOpen")),!this._empty(b)){for(a=this.append(a,this.template("ellipsis")),d=this.template("innerBlock"),f=0;f<b.length;f++)e=this._buildObjEl(b[f],!1),f<b.length-1&&(e=this.append(e,this.template("comma"))),d=this.append(d,e);a=this.append(a,d)}a=this.append(a,this.template("bracketClose"));break;case"number":a=this.setText(a,b),a.classList.add("number");break;case"regex":a=this.setText(a,b),a.classList.add("regex");break;case"boolean":a=this.setText(a,b),a.classList.add("boolean");break;case"null":a=this.setText(a,"null"),a.classList.add("null");break;default:console.log("default type",c);var i=JSON.stringify(b);a=this.setText(a,i)}return a},d.prototype._buildObjEl=function(a,b){var d=c.prototype.typeOfObj(a),e=this.createEl("span","object");return b=b||!1,e=this._attachValPrefix(e,a,b,d),e=this._attachKeyDom(e,a,d)},d.prototype.updateEl=function(a){a.innerHTML="updating!"},d.prototype.createEl=function(a,b,c){a=a||"span";var d=this.base[a].cloneNode(!1);return b&&(d.className=b),d=this.setText(d,c)},d.prototype.template=function(a){var b=this.templates[a].cloneNode(!0);return b},d.prototype.createAnchor=function(a,b,c){c=c||function(){};var d=this.setText(this.base.a.cloneNode(!1),a);return b&&(d.className=b),d.href="#",d.onclick=function(){return c(),!1},d},d.prototype._modkey=function(){return-1!==navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey"},d.prototype.clickHandler=function(a){if(1===a.which){var b=a.target;if("icon-arrow"===b.className){a.preventDefault();var c=b.parentNode,e=a[d.prototype._modkey()]?Array.prototype.slice.call(c.parentNode.children):c,f=c.classList.contains("collapsed")?!0:!1;return void d.prototype.toggle(e,f)}}},d.prototype.toggle=function(a,b){var c=[];a instanceof Array?c=a:c.push(a),b&&c.length?d.prototype.expand(c):d.prototype.collapse(c)},d.prototype.collapse=function(a){var b,c=a.length-1;for(c;c>=0;c--)b=a[c],b.classList.add("collapsed")},d.prototype.expand=function(a){var b=a.length-1;for(b;b>=0;b--)a[b].classList.remove("collapsed")},d.prototype.setText=function(a,b){if(!b||""===b)return a;var c=this.base.text.cloneNode(!1);return c.nodeValue=b,this.append(a,c)},d.prototype.domToText=function(a){var b=this.createEl("div");return b.appendChild(a),b.innerHTML},d.prototype.wrap=function(a,b,c){return this.append(a,this.template(c),b,this.template(c))},d.prototype.append=function(){var a,b=Array.prototype.shift.call(arguments);for(a=0;a<arguments.length;a++)arguments[a].constructor==Array?this.append.apply(this,[b].concat(arguments[a])):b.appendChild(arguments[a]);return b},d.prototype.prepend=function(a,b){return a.insertBefore(b,a.firstChild),a};var e=function(){};e.prototype.update=function(a,b){console.log("Updating with!",b)},c.prototype.r=new d,c.prototype.d=new e,window.Visualizer=c}(Sizzle,jsondiffpatch);