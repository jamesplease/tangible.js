!function(a){"use strict";var b=function(b,c){this.Sizzle=a,this.obj=b,this.el=c,this.observer=jsonpatch.observe(this.obj,this.d._updateDomPls)};b.prototype.typeOfObj=function(a){return"undefined"==typeof a?"undefined":null===a?"null":"string"==typeof a?"string":"number"==typeof a?"number":"boolean"==typeof a?"boolean":a instanceof RegExp?"regex":a instanceof Array?"array":"object"},b.prototype.update=function(){jsonpatch.generate(this.observer)},b.prototype.render=function(a){a=a||{},a.raw=a.raw||!1;var b=this.r.render(this.obj,a);this.el.appendChild(b)},b.prototype.destroy=function(){jsonpatch.unobserve(this.obj,this.observer)};var c=function(){this.base={text:document.createTextNode(""),span:document.createElement("span"),div:document.createElement("div"),pre:document.createElement("pre"),a:document.createElement("a")},this.templates={arrow:this.createEl("span","icon-arrow"),number:this.createEl("span","number"),string:this.createEl("span","string"),key:this.createEl("span","key"),empty:this.createEl("span","null"),innerBlock:this.createEl("span","inner-block"),quote:this.createEl("span","quote",'"'),bracketOpen:this.createEl("span","bracket bracket-open","["),bracketClose:this.createEl("span","bracket bracket-close","]"),braceOpen:this.createEl("span","brace brace-open","{"),braceClose:this.createEl("span","brace brace-close","}"),ellipsis:this.createEl("span","ellipsis"),comma:this.createEl("span","comma",","),sep:this.createEl("span","sep",":Â ")},document.addEventListener("click",this.clickHandler,!1)};c.prototype.render=function(a,b){if(b&&b.raw){var c=this.setText(this.createEl("pre"),a);return c.className="json-view",c}return this._renderObj(a)},c.prototype._renderObj=function(a){var b=this._buildObjEl(a);return this.append(this.createEl("span","js-visualizer"),b)},c.prototype._empty=function(a){var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0},c.prototype._group=function(a){var c=b.prototype.typeOfObj(a);return"object"===c||"array"===c},c.prototype._attachValPrefix=function(a,b,c){if(this._group(b)&&!this._empty(b)&&(a=this.append(a,this.template("arrow"))),c!==!1){a.classList.add("object-property");var d=this.template("key");d=this.setText(d,JSON.stringify(c).slice(1,-1)),a=this.wrap(a,d,"quote"),a=this.append(a,this.template("sep"))}else a.classList.add("array-element");return a},c.prototype._attachKeyDom=function(a,b,c){var d,e,f,g;switch(c){case"string":d=this.createEl("span");var h=this.template("string"),i=JSON.stringify(b);i=i.substring(1,i.length-1),h=this.setText(h,i),d=this.wrap(d,h,"quote"),a=this.append(a,d);break;case"object":if(a=this.append(a,this.template("braceOpen")),!this._empty(b)){a=this.append(a,this.template("ellipsis")),d=this.template("innerBlock");for(f in b)b.hasOwnProperty(f)&&(e=this._buildObjEl(b[f],f),f<b.length-1&&(e=this.append(e,this.template("comma"))),d=this.append(d,e));a=this.append(a,d)}a=this.append(a,this.template("braceClose"));break;case"array":if(a=this.append(a,this.template("bracketOpen")),!this._empty(b)){for(a=this.append(a,this.template("ellipsis")),d=this.template("innerBlock"),f=0;f<b.length;f++)e=this._buildObjEl(b[f],!1),f<b.length-1&&(e=this.append(e,this.template("comma"))),d=this.append(d,e);a=this.append(a,d)}a=this.append(a,this.template("bracketClose"));break;case"null":g="null";case"undefined":g="undefined";case"number":case"regex":case"boolean":g=String(b),d=this.createEl("span"),d=this.setText(d,g),d.classList.add(c),a=this.append(a,d);break;default:console.log("default type",c);var j=JSON.stringify(b);a=this.setText(a,j)}return a},c.prototype._buildObjEl=function(a,c){var d=b.prototype.typeOfObj(a),e=this.createEl("span","object");return c=c||!1,e=this._attachValPrefix(e,a,c,d),e=this._attachKeyDom(e,a,d)},c.prototype.createEl=function(a,b,c){a=a||"span";var d=this.base[a].cloneNode(!1);return b&&(d.className=b),d=this.setText(d,c)},c.prototype.template=function(a){var b=this.templates[a].cloneNode(!0);return b},c.prototype.createAnchor=function(a,b,c){c=c||function(){};var d=this.setText(this.base.a.cloneNode(!1),a);return b&&(d.className=b),d.href="#",d.onclick=function(){return c(),!1},d},c.prototype._modkey=function(){return-1!==navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey"},c.prototype.clickHandler=function(a){if(1===a.which){var b=a.target;if("icon-arrow"===b.className){a.preventDefault();var d=b.parentNode,e=a[c.prototype._modkey()]?Array.prototype.slice.call(d.parentNode.children):d,f=d.classList.contains("collapsed")?!0:!1;return void c.prototype.toggle(e,f)}}},c.prototype.toggle=function(a,b){var d=[];a instanceof Array?d=a:d.push(a),b&&d.length?c.prototype.expand(d):c.prototype.collapse(d)},c.prototype.collapse=function(a){var b,c=a.length-1;for(c;c>=0;c--)b=a[c],b.classList.add("collapsed")},c.prototype.expand=function(a){var b=a.length-1;for(b;b>=0;b--)a[b].classList.remove("collapsed")},c.prototype.setText=function(a,b){if(!b||""===b)return a;var c=this.base.text.cloneNode(!1);return c.nodeValue=b,this.append(a,c)},c.prototype.domToText=function(a){var b=this.createEl("div");return b.appendChild(a),b.innerHTML},c.prototype.wrap=function(a,b,c){return this.append(a,this.template(c),b,this.template(c))},c.prototype.append=function(){var a,b=Array.prototype.shift.call(arguments);for(a=0;a<arguments.length;a++)arguments[a].constructor==Array?this.append.apply(this,[b].concat(arguments[a])):b.appendChild(arguments[a]);return b},c.prototype.insertAfter=function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},c.prototype.prepend=function(a,b){return a.insertBefore(b,a.firstChild),a};var d=function(a){this.r=a,this.el=b.el};d.prototype._updateDomPls=function(a){var b=a.length-1;for(b;b>=0;b--)this._something(d.prototype._something(a[b]))},d.prototype._something=function(a){var b=d.prototype._generateSelector(a.path);console.log("selector:",b)},d.prototype._generateSelector=function(a){return a},d.prototype._deltaType=function(a){return console.log(a),a instanceof Array?1===a.length?"added":2===a.length?"modified":3===a.length&&a[1]===a[2]===0?"deleted":3===a.length&&0===a[1]&&2===a[2]?"text-diff":3===a.length&&0===a[0]&&3===a[3]?"moved":void 0:"a"===a._t?"update-array":"update-object"},d.prototype.update=function(b,c,d,e){var f=this._deltaType(d);e=e||".js-visualizer";var g,h,i;switch(f){case"modified":e+="> .array-element",h=d[1],i=this.r.render(h),g=a(e,b)[0],g.innerHTML="",this.r.append(g,i);break;case"update-array":e+="> .array-element",g=a(e,b)[0],i=g.cloneNode(!0),this._manipulateArrayDom(i,d),g.innerHTML="",this.r.append(g,i);break;case"update-object":}},d.prototype._manipulateArrayDom=function(a,b){var c;for(c in b)if(b.hasOwnProperty(c)){if("_t"===c)continue;"_"===c.charAt(0)}},b.prototype.r=new c,b.prototype.d=new d(b.prototype.r,b.el),window.Visualizer=b}(Sizzle,jsonpatch);